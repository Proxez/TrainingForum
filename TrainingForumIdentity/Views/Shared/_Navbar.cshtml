@using Application.Service.Interface
@using Entities
@inject ICategoryService CategoryService
@inject ISubCategoryService SubCategoryService

@{
    var categories = await CategoryService.GetAllCategoriesAsync() ?? new List<Category>();
    var subCategories = await SubCategoryService.GetAllSubCategoriesAsync() ?? new List<SubCategory>();
    var subsByCategory = subCategories.ToLookup(s => s.CategoryId);
}

<div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
    <ul class="navbar-nav flex-grow-1">

        @foreach (var cat in categories)
        {
            var subs = subsByCategory[cat.Id].ToList();
            var hasSubs = subs.Count > 0;

            <li class="nav-item @(hasSubs ? "dropdown" : "")">
                <a class="nav-link text-dark @(hasSubs ? "dropdown-toggle" : "")"
                   asp-controller="Category"
                   asp-action="Category"
                   asp-route-id="@cat.Id"
                   data-bs-toggle="@(hasSubs ? "dropdown" : null)"
                   role="@(hasSubs ? "button" : null)"
                   aria-expanded="@(hasSubs ? "false" : null)">
                    @cat.Title
                </a>

                @if (hasSubs)
                {
                    <ul class="dropdown-menu">
                        <!-- Valfritt “Visa alla” som första val -->
                        <li>
                            <a class="dropdown-item fw-semibold"
                               asp-controller="Category"
                               asp-action="Category"
                               asp-route-id="@cat.Id">
                                Visa alla @cat.Title
                            </a>
                        </li>
                        <li><hr class="dropdown-divider" /></li>

                        @foreach (var sub in subs)
                        {
                            <li>
                                <a class="dropdown-item"
                                   asp-controller="SubCategory"
                                   asp-action="SubCategory"
                                   asp-route-id="@sub.Id">
                                    @sub.Title
                                </a>
                            </li>
                        }
                    </ul>
                }
            </li>
        }

        @* Exempel: adminlänk *@
        @if (User.IsInRole("Owner") || User.IsInRole("Admin"))
        {
            <li class="nav-item">
                <a class="nav-link text-dark" asp-controller="Home" asp-action="Admin">Admin</a>
            </li>
        }
    </ul>
</div>
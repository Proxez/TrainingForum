@model List<Post>
@{
    ViewData["Title"] = "Home Page";
}


@if (Model?.Any() == true)
{
    @foreach (var post in Model)
    {
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">@post.Title</h5>

                <p class="card-text">
                    @{
                        var text = post.Content ?? "";
                        var preview = text.Length > 240 ? text.Substring(0, 240) + "..." : text;
                    }
                    @preview
                </p>

                <p class="card-text">
                    <small class="text-muted">
                        @("Av " + (post.User?.UserName ?? "okänd"))
                        • @post.CreatedAt.ToLocalTime().ToString("g")
                        @if (post.SubCategory is not null)
                        {
                            <text> • @post.SubCategory.Title</text>
                        }
                    </small>
                </p>

                <a asp-controller="ForumPost"
                   asp-action="ViewPost"
                   asp-route-id="@post.Id"
                   class="btn btn-primary btn-sm">Visa</a>

            </div>

            @if (!string.IsNullOrEmpty(post.ImageUrl))
            {
                <img class="card-img-bottom" src="@post.ImageUrl" alt="Bild" />
            }
        </div>
    }
    @if (Context.Request.Query.ContainsKey("page"))
    {
        var page = int.TryParse(Context.Request.Query["page"], out var p) ? p : 1;
        <div class="d-flex gap-2">
            @if (page > 1)
            {
                <a class="btn btn-outline-secondary" asp-action="Index" asp-route-page="@(page - 1)">Föregående</a>
            }
            <a class="btn btn-outline-secondary" asp-action="Index" asp-route-page="@(page + 1)">Nästa</a>
        </div>
    }
    else
    {
        <div class="mt-2">
            <a class="btn btn-outline-secondary" asp-action="Index" asp-route-page="2">Nästa</a>
        </div>
    }
}
else
{
    <div class="alert alert-info">Inga inlägg ännu.</div>
}
 
@if (User?.Identity?.IsAuthenticated == true)
{
    <div class="mt-3">
        <a asp-controller="ForumPost" asp-action="CreatePost" class="btn btn-success">Skapa nytt inlägg</a>
    </div>
} 
